var Map = function (mapFile) {

	this.tiles = [];
	this.controlPoints = [];
	this.path = [];

	this.mapFile = mapFile ? mapFile : Map.getDefaultMap();

	this.loadMap = function () {
		var data = JSON.parse(this.mapFile);

		for (var i = 0; i < data.length; i++) {
			var record = data[i];
			var tile = new Tile("#926239", record.x, record.y, record.width, record.height, true);

			this.tiles.push(tile);
			this.controlPoints.push(tile.getCenter());

			if (this.controlPoints.length > 3) {
				this.path = Bezier.calculateCurve(this.controlPoints);
			}
		}
	};

	this.render = function (canvas, drawPath) {
		this.tiles.forEach(function (tile) {
			tile.render(canvas);
		});

		if (drawPath) {
			this.path.forEach(function (p) {
				canvas.context.fillStyle = "#FF0000";
				canvas.context.fillRect(p.x, p.y, 1, 1);
			});
		}
	};
};

Map.getDefaultMap = function () {
	return window.atob("W3siY29sb3IiOiIjOTI2MjM5IiwieCI6MCwieSI6MTYwLCJ3aWR0aCI6MjYuNjY2NjY2NjY2NjY2NjY4LCJoZWlnaHQiOjIwLCJhbHBoYSI6MX0seyJjb2xvciI6IiM5MjYyMzkiLCJ4IjoyNi42NjY2 NjY2NjY2NjY2NjgsInkiOjE2MCwid2lkdGgiOjI2LjY2NjY2NjY2NjY2NjY2OCwiaGVpZ2h0Ijoy MCwiYWxwaGEiOjF9LHsiY29sb3IiOiIjOTI2MjM5IiwieCI6NTMuMzMzMzMzMzMzMzMzMzM2LCJ5 IjoxNjAsIndpZHRoIjoyNi42NjY2NjY2NjY2NjY2NjgsImhlaWdodCI6MjAsImFscGhhIjoxfSx7 ImNvbG9yIjoiIzkyNjIzOSIsIngiOjUzLjMzMzMzMzMzMzMzMzMzNiwieSI6MTgwLCJ3aWR0aCI6 MjYuNjY2NjY2NjY2NjY2NjY4LCJoZWlnaHQiOjIwLCJhbHBoYSI6MX0seyJjb2xvciI6IiM5MjYy MzkiLCJ4Ijo4MCwieSI6MTgwLCJ3aWR0aCI6MjYuNjY2NjY2NjY2NjY2NjY4LCJoZWlnaHQiOjIw LCJhbHBoYSI6MX0seyJjb2xvciI6IiM5MjYyMzkiLCJ4Ijo4MCwieSI6MjAwLCJ3aWR0aCI6MjYu NjY2NjY2NjY2NjY2NjY4LCJoZWlnaHQiOjIwLCJhbHBoYSI6MX0seyJjb2xvciI6IiM5MjYyMzki LCJ4IjoxMDYuNjY2NjY2NjY2NjY2NjcsInkiOjIwMCwid2lkdGgiOjI2LjY2NjY2NjY2NjY2NjY2 OCwiaGVpZ2h0IjoyMCwiYWxwaGEiOjF9LHsiY29sb3IiOiIjOTI2MjM5IiwieCI6MTA2LjY2NjY2 NjY2NjY2NjY3LCJ5IjoyMjAsIndpZHRoIjoyNi42NjY2NjY2NjY2NjY2NjgsImhlaWdodCI6MjAs ImFscGhhIjoxfSx7ImNvbG9yIjoiIzkyNjIzOSIsIngiOjEzMy4zMzMzMzMzMzMzMzMzNCwieSI6 MjIwLCJ3aWR0aCI6MjYuNjY2NjY2NjY2NjY2NjY4LCJoZWlnaHQiOjIwLCJhbHBoYSI6MX0seyJj b2xvciI6IiM5MjYyMzkiLCJ4IjoxNjAsInkiOjIyMCwid2lkdGgiOjI2LjY2NjY2NjY2NjY2NjY2 OCwiaGVpZ2h0IjoyMCwiYWxwaGEiOjF9LHsiY29sb3IiOiIjOTI2MjM5IiwieCI6MTg2LjY2NjY2 NjY2NjY2NjY5LCJ5IjoyMjAsIndpZHRoIjoyNi42NjY2NjY2NjY2NjY2NjgsImhlaWdodCI6MjAs ImFscGhhIjoxfSx7ImNvbG9yIjoiIzkyNjIzOSIsIngiOjE4Ni42NjY2NjY2NjY2NjY2OSwieSI6 MjQwLCJ3aWR0aCI6MjYuNjY2NjY2NjY2NjY2NjY4LCJoZWlnaHQiOjIwLCJhbHBoYSI6MX0seyJj b2xvciI6IiM5MjYyMzkiLCJ4IjoyMTMuMzMzMzMzMzMzMzMzMzQsInkiOjI0MCwid2lkdGgiOjI2 LjY2NjY2NjY2NjY2NjY2OCwiaGVpZ2h0IjoyMCwiYWxwaGEiOjF9LHsiY29sb3IiOiIjOTI2MjM5 IiwieCI6MjEzLjMzMzMzMzMzMzMzMzM0LCJ5IjoyNjAsIndpZHRoIjoyNi42NjY2NjY2NjY2NjY2 NjgsImhlaWdodCI6MjAsImFscGhhIjoxfSx7ImNvbG9yIjoiIzkyNjIzOSIsIngiOjI0MCwieSI6 MjYwLCJ3aWR0aCI6MjYuNjY2NjY2NjY2NjY2NjY4LCJoZWlnaHQiOjIwLCJhbHBoYSI6MX0seyJj b2xvciI6IiM5MjYyMzkiLCJ4IjoyNDAsInkiOjI0MCwid2lkdGgiOjI2LjY2NjY2NjY2NjY2NjY2 OCwiaGVpZ2h0IjoyMCwiYWxwaGEiOjF9LHsiY29sb3IiOiIjOTI2MjM5IiwieCI6MjQwLCJ5Ijoy MjAsIndpZHRoIjoyNi42NjY2NjY2NjY2NjY2NjgsImhlaWdodCI6MjAsImFscGhhIjoxfSx7ImNv bG9yIjoiIzkyNjIzOSIsIngiOjI0MCwieSI6MjAwLCJ3aWR0aCI6MjYuNjY2NjY2NjY2NjY2NjY4 LCJoZWlnaHQiOjIwLCJhbHBoYSI6MX0seyJjb2xvciI6IiM5MjYyMzkiLCJ4IjoyNjYuNjY2NjY2 NjY2NjY2NywieSI6MjAwLCJ3aWR0aCI6MjYuNjY2NjY2NjY2NjY2NjY4LCJoZWlnaHQiOjIwLCJh bHBoYSI6MX0seyJjb2xvciI6IiM5MjYyMzkiLCJ4IjoyOTMuMzMzMzMzMzMzMzMzMzcsInkiOjIw MCwid2lkdGgiOjI2LjY2NjY2NjY2NjY2NjY2OCwiaGVpZ2h0IjoyMCwiYWxwaGEiOjF9LHsiY29s b3IiOiIjOTI2MjM5IiwieCI6MzIwLCJ5IjoyMDAsIndpZHRoIjoyNi42NjY2NjY2NjY2NjY2Njgs ImhlaWdodCI6MjAsImFscGhhIjoxfSx7ImNvbG9yIjoiIzkyNjIzOSIsIngiOjMyMCwieSI6MjIw LCJ3aWR0aCI6MjYuNjY2NjY2NjY2NjY2NjY4LCJoZWlnaHQiOjIwLCJhbHBoYSI6MX0seyJjb2xv ciI6IiM5MjYyMzkiLCJ4IjozNDYuNjY2NjY2NjY2NjY2NywieSI6MjIwLCJ3aWR0aCI6MjYuNjY2 NjY2NjY2NjY2NjY4LCJoZWlnaHQiOjIwLCJhbHBoYSI6MX0seyJjb2xvciI6IiM5MjYyMzkiLCJ4 IjozNDYuNjY2NjY2NjY2NjY2NywieSI6MjQwLCJ3aWR0aCI6MjYuNjY2NjY2NjY2NjY2NjY4LCJo ZWlnaHQiOjIwLCJhbHBoYSI6MX0seyJjb2xvciI6IiM5MjYyMzkiLCJ4IjozNzMuMzMzMzMzMzMz MzMzMzcsInkiOjI0MCwid2lkdGgiOjI2LjY2NjY2NjY2NjY2NjY2OCwiaGVpZ2h0IjoyMCwiYWxw aGEiOjF9LHsiY29sb3IiOiIjOTI2MjM5IiwieCI6MzczLjMzMzMzMzMzMzMzMzM3LCJ5IjoyMjAs IndpZHRoIjoyNi42NjY2NjY2NjY2NjY2NjgsImhlaWdodCI6MjAsImFscGhhIjoxfSx7ImNvbG9y IjoiIzkyNjIzOSIsIngiOjM3My4zMzMzMzMzMzMzMzMzNywieSI6MjAwLCJ3aWR0aCI6MjYuNjY2 NjY2NjY2NjY2NjY4LCJoZWlnaHQiOjIwLCJhbHBoYSI6MX0seyJjb2xvciI6IiM5MjYyMzkiLCJ4 IjozNzMuMzMzMzMzMzMzMzMzMzcsInkiOjE4MCwid2lkdGgiOjI2LjY2NjY2NjY2NjY2NjY2OCwi aGVpZ2h0IjoyMCwiYWxwaGEiOjF9LHsiY29sb3IiOiIjOTI2MjM5IiwieCI6NDAwLCJ5IjoxODAs IndpZHRoIjoyNi42NjY2NjY2NjY2NjY2NjgsImhlaWdodCI6MjAsImFscGhhIjoxfSx7ImNvbG9y IjoiIzkyNjIzOSIsIngiOjQyNi42NjY2NjY2NjY2NjY3LCJ5IjoxODAsIndpZHRoIjoyNi42NjY2 NjY2NjY2NjY2NjgsImhlaWdodCI6MjAsImFscGhhIjoxfSx7ImNvbG9yIjoiIzkyNjIzOSIsIngi OjQ1My4zMzMzMzMzMzMzMzMzNywieSI6MTgwLCJ3aWR0aCI6MjYuNjY2NjY2NjY2NjY2NjY4LCJo ZWlnaHQiOjIwLCJhbHBoYSI6MX0seyJjb2xvciI6IiM5MjYyMzkiLCJ4Ijo0ODAsInkiOjE4MCwi d2lkdGgiOjI2LjY2NjY2NjY2NjY2NjY2OCwiaGVpZ2h0IjoyMCwiYWxwaGEiOjF9LHsiY29sb3Ii OiIjOTI2MjM5IiwieCI6NTA2LjY2NjY2NjY2NjY2NjcsInkiOjE4MCwid2lkdGgiOjI2LjY2NjY2 NjY2NjY2NjY2OCwiaGVpZ2h0IjoyMCwiYWxwaGEiOjF9LHsiY29sb3IiOiIjOTI2MjM5IiwieCI6 NTMzLjMzMzMzMzMzMzMzMzQsInkiOjE4MCwid2lkdGgiOjI2LjY2NjY2NjY2NjY2NjY2OCwiaGVp Z2h0IjoyMCwiYWxwaGEiOjF9LHsiY29sb3IiOiIjOTI2MjM5IiwieCI6NTMzLjMzMzMzMzMzMzMz MzQsInkiOjIwMCwid2lkdGgiOjI2LjY2NjY2NjY2NjY2NjY2OCwiaGVpZ2h0IjoyMCwiYWxwaGEi OjF9LHsiY29sb3IiOiIjOTI2MjM5IiwieCI6NTg2LjY2NjY2NjY2NjY2NjcsInkiOjIwMCwid2lk dGgiOjI2LjY2NjY2NjY2NjY2NjY2OCwiaGVpZ2h0IjoyMCwiYWxwaGEiOjF9LHsiY29sb3IiOiIj OTI2MjM5IiwieCI6NTg2LjY2NjY2NjY2NjY2NjcsInkiOjIyMCwid2lkdGgiOjI2LjY2NjY2NjY2 NjY2NjY2OCwiaGVpZ2h0IjoyMCwiYWxwaGEiOjF9LHsiY29sb3IiOiIjOTI2MjM5IiwieCI6NTYw LCJ5IjoyMjAsIndpZHRoIjoyNi42NjY2NjY2NjY2NjY2NjgsImhlaWdodCI6MjAsImFscGhhIjox fSx7ImNvbG9yIjoiIzkyNjIzOSIsIngiOjU2MCwieSI6MjQwLCJ3aWR0aCI6MjYuNjY2NjY2NjY2 NjY2NjY4LCJoZWlnaHQiOjIwLCJhbHBoYSI6MX0seyJjb2xvciI6IiM5MjYyMzkiLCJ4Ijo1ODYu NjY2NjY2NjY2NjY2NywieSI6MjQwLCJ3aWR0aCI6MjYuNjY2NjY2NjY2NjY2NjY4LCJoZWlnaHQi OjIwLCJhbHBoYSI6MX0seyJjb2xvciI6IiM5MjYyMzkiLCJ4Ijo1ODYuNjY2NjY2NjY2NjY2Nywi eSI6MjgwLCJ3aWR0aCI6MjYuNjY2NjY2NjY2NjY2NjY4LCJoZWlnaHQiOjIwLCJhbHBoYSI6MX0s eyJjb2xvciI6IiM5MjYyMzkiLCJ4Ijo2MTMuMzMzMzMzMzMzMzMzNCwieSI6MjgwLCJ3aWR0aCI6 MjYuNjY2NjY2NjY2NjY2NjY4LCJoZWlnaHQiOjIwLCJhbHBoYSI6MX0seyJjb2xvciI6IiM5MjYy MzkiLCJ4Ijo1ODYuNjY2NjY2NjY2NjY2NywieSI6MjYwLCJ3aWR0aCI6MjYuNjY2NjY2NjY2NjY2 NjY4LCJoZWlnaHQiOjIwLCJhbHBoYSI6MX0seyJjb2xvciI6IiM5MjYyMzkiLCJ4Ijo2NDAsInki OjI4MCwid2lkdGgiOjI2LjY2NjY2NjY2NjY2NjY2OCwiaGVpZ2h0IjoyMCwiYWxwaGEiOjF9LHsi Y29sb3IiOiIjOTI2MjM5IiwieCI6NjY2LjY2NjY2NjY2NjY2NjcsInkiOjI4MCwid2lkdGgiOjI2 LjY2NjY2NjY2NjY2NjY2OCwiaGVpZ2h0IjoyMCwiYWxwaGEiOjF9LHsiY29sb3IiOiIjOTI2MjM5 IiwieCI6NjkzLjMzMzMzMzMzMzMzMzQsInkiOjI4MCwid2lkdGgiOjI2LjY2NjY2NjY2NjY2NjY2 OCwiaGVpZ2h0IjoyMCwiYWxwaGEiOjF9LHsiY29sb3IiOiIjOTI2MjM5IiwieCI6NzIwLCJ5Ijoy ODAsIndpZHRoIjoyNi42NjY2NjY2NjY2NjY2NjgsImhlaWdodCI6MjAsImFscGhhIjoxfSx7ImNv bG9yIjoiIzkyNjIzOSIsIngiOjc0Ni42NjY2NjY2NjY2NjY3LCJ5IjoyODAsIndpZHRoIjoyNi42 NjY2NjY2NjY2NjY2NjgsImhlaWdodCI6MjAsImFscGhhIjoxfSx7ImNvbG9yIjoiIzkyNjIzOSIs IngiOjc3My4zMzMzMzMzMzMzMzM0LCJ5IjoyODAsIndpZHRoIjoyNi42NjY2NjY2NjY2NjY2Njgs ImhlaWdodCI6MjAsImFscGhhIjoxfV0=");
};